<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <title>Dependency Analysis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" />
    <style>
        div.attribution {
            border: 1px solid #ddd;
            background-color: #bbb;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1>Dependency Analysis</h1>
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#tabs-1">Basic Info</a></li>
            <li><a data-toggle="tab" href="#tabs-3">List</a></li>
            <li><a data-toggle="tab" href="#tabs-4">Messages</a></li>
            <li><a data-toggle="tab" href="#tabs-5">About</a></li>
        </ul>
        <div class="tab-content">
            <div id="tabs-1" class="tab-pane fade in active">
                <h2>Date Collected: <span id='RunDate'></span></h2>
            </div>
            <div id="tabs-3" class="tab-pane">
                <table id="deps" class="table table-striped table-bordered table-hover" cellspacing="0">
                    <thead>
                        <tr>
                            <th>SrcPkg</th>
                            <th>SrcModule</th>
                            <th>Dependency Type</th>
                            <th>Dependency Pkg</th>
                            <th>Dependency</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                        <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div id="tabs-4" class="tab-pane">
                <h2>Tool Messages</h2>
                <div id="messages">
                    <ol></ol>
                </div>
            </div>
            <div id="tabs-5" class="tab-pane">
                <div class="row">
                    <div class="col-xs-7">
                        <p></p>
                        <p>
                            Dependency Template Version: <span id="TemplateVersion">1.00</span><br />
                            Dependency Tool Version: <span id='ToolVersion'></span><br />
                        </p>
                        <h3>License</h3>
                        <hr />
                        <div id="ToolLicenseContent">
                            <p>
                                <span class="copyright">Copyright (c) 2017, Microsoft Corporation</span><br />
                                <span class="license">
                                    All rights reserved. Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:<br>
                                    1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.<br>
                                    2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.<br><br>

                                    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
                                    ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
                                    WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
                                    IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
                                    INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
                                    BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
                                    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
                                    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
                                    OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
                                    ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
                                </span>
                            </p>
                        </div>
                    </div>
                    <div id="AttributionListWrapper" class="col-xs-5">
                        <h3>External Licenses</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var EmbeddedJd = %TO_BE_FILLED_IN_BY_PYTHON_SCRIPT%;
    </script>

    <!-- Javascript libraries -->
    <script type="text/javascript" charset="utf8" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.7/bootstrap.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>

    <!-- Add javascript here -->
    <script>
        var DATA_TABLE_OFFSET = 400;
        $(document).ready(function () {
            $('#RunDate').text(EmbeddedJd.DateCollected);
            $('span#ToolVersion').text(EmbeddedJd.ToolVersion);

            //To support tabs and correct column width we need this change
            $('a[data-toggle="tab"][href="#tabs-3"]').on('shown.bs.tab', function (e) {
                $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
            });

            //
            //Write out errors or warnings in the data processing
            //
            EmbeddedJd.errors.forEach(function (element, index, array) {
                $("div#messages > ol").append("<li>" + element +"</li>");
            });  //end forEach

          
            $('#fvtablist a:first').tab('show'); //set the first one active
            //
            // Create Attribution List for all external libraries used
            //
            [
                { Title: "JQuery", Copyright: "Copyright 2017 The jQuery Foundation", Version: $.fn.jquery, LicenseType: "MIT", LicenseLink: "https://jquery.org/license/" },
                { Title: "DataTables", Copyright: "DataTables designed and created by SpryMedia Ltd Copyright 2007-2017", Version: $.fn.dataTable.version, LicenseType: "MIT", LicenseLink: "https://datatables.net/license/mit" },
                { Title: "BootStrap", Copyright: "Code and documentation copyright 2011-2017 the Bootstrap Authors and Twitter, Inc.", Version: "3.3.7", LicenseType: "MIT", LicenseLink: "https://github.com/twbs/bootstrap/blob/master/LICENSE" },            ].forEach(function (element) {
                $("<div class='attribution'><h4>" + element.Title + "</h4><p>Version: <span class='version'>" + element.Version + "</span><br /><span class='copyright'>" +
                    element.Copyright + "</span><br />License: <a class='license' href='" + element.LicenseLink + "'>" + element.LicenseType + "</a></p></div>").appendTo("div#AttributionListWrapper");
            });
           


             //table for modules
             var mTable = $('table#deps').dataTable({
                "aaData": EmbeddedJd.deps,
                "paginate": false,
                "autoWidth": false,
                "scrollY": ($(window).height() - DATA_TABLE_OFFSET) + "px",
                "aaSorting": [[0, "desc"]],
                "aoColumnDefs": [
                    {
                        "mData": "SrcPkg",
                        "aTargets": [0]
                    },
                    {
                        "mData": "SrcInf",
                        "aTargets": [1]
                    },
                    {
                        "mData": "DepType",
                        "aTargets": [2],
                    },
                    {
                        "mData": "DepPkg",
                        "aTargets": [3],
                    },
                    {
                        "mData": "Dep",
                        "aTargets": [4],
                    }
                ], //end of column def

                initComplete: function () {
                    this.api().columns([0, 2, 3]).every( function () {
                    var column = this;
                    var select = $('<select><option value=""></option></select>')
                        .appendTo( $(column.footer()).empty() )
                        .on( 'change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );
     
                            column
                                .search( val ? '^'+val+'$' : '', true, false )
                                .draw();
                        } );
 
                        column.data().unique().sort().each( function ( d, j ) {
                            select.append( '<option value="'+d+'">'+d+'</option>' )
                        });
                    });  //columns 0,2,3

                    this.api().columns([1,4]).every(function() {
                        var column = this;
                        $(this.footer()).html('<input type="text" placeholder="Search" />');
                        $( 'input', this.footer() ).on( 'keyup change', function () {
                            if ( column.search() !== this.value ) {
                                column
                                .search( this.value )
                                .draw();
                            }
                        } );
                    });  //column 1,4
                    $('table#deps tfoot tr').appendTo('table#deps thead');
                } //end init complete func
            }) //end of modules table
            
        }); //end on ready
                //
        //To handle scroll tables adjust the height based on the window height.
        //
        $(window).resize(function() {
            var newHd = $(window).height() - DATA_TABLE_OFFSET;
            $("#deps_wrapper .dataTables_scrollBody").height(newHd);
        });

    </script>
</body>
</html>
